# 弹墙（暂定名）游戏设计文档

## 核心概念

- **玩法类型**：单人街机式反应游戏。
- **目标**：在球坠出场地之前，通过按键临时启用下边墙让球反弹，尽可能维持连击次数。
- **节奏感**：球每次在实化的下边墙反弹都会加速，音高以半音递增，形成紧张、逐渐升级的节奏。

## 交互规则

1. 球体在封闭方框内弹跳。上、左、右三面为永久实墙，自动反弹。
2. 下边墙默认为虚化状态（透明），球可穿透。玩家按住 `确认`（默认空格/回车）时，下边墙立即实化并可反弹球。
   - 底墙在淡出阶段仅当透明度不低于 `0.6` 时仍具有碰撞体，该阈值由 `scripts/game_manager.gd` 中的 `@export var bottom_bounce_alpha_threshold` 控制，亦可在 Inspector 面板直接调整。
   - 底墙满亮的保持时间与随后的淡出时长分别由 `bottom_active_duration`（默认 `0.1s`）和 `bottom_fade_duration`（默认 `0.2s`）控制，两者同样暴露在 `scripts/game_manager.gd` 顶部，可在 Inspector 上微调；淡出结束后的残余透明度由 `bottom_ghost_alpha` 决定。
   - 重新激活前的最小等待时间由 `bottom_rearm_cooldown`（默认 `0.1s`）与 `bottom_rearm_cooldown_min`（默认 `0s`）组合控制：冷却从底墙完全淡出成幽灵态的那一瞬间开始计时，计时满额后才允许下一次按键重新实化。随着球速提升（连击未重置时），冷却会在这两个值之间线性压缩，当球速因第 20 次连击复位时冷却也回到基准值。
3. 每次在实化的下边墙反弹：
   - 球速提升一个固定倍率。
   - 触发比上一次高半音的提示音。
   - 连击数达到 20 的倍数时，会把球速与音高同时重置到初始值，避免节奏失控。
4. 按键长按现在分为三个阶段：
   - 0 ~ 0.3 秒：保持常速（1×）。
   - 0.3 秒瞬间切换到 2×。
   - 0.3 ~ 0.8 秒：在 0.5 秒的区间内从 2× 线性加速到 3×，0.8 秒后保持 3×；中途松开会立即回到常速。
5. 若球越界（未能用实化墙接住），会重置至场地中央并恢复初始速度、音调。
6. 每次在底墙成功反弹后，当前障碍会像抽屉一样缩回其所属的墙面，随后新的障碍从另一侧墙体缓慢伸出并伴随轻微回弹，始终只存在一个障碍。障碍开始伸出时，会立即在下一堵墙面生成尖刺指示器，提醒玩家下一次抽屉的位置。
7. 场地保持为屏幕中央的正方形区域，下墙默认虚化但保持直线，与其他墙体厚度一致。

## 视觉与音效

- **背景**：纯黑。
- **球与墙体**：纯白，使用程序化绘制，碰撞盒与视觉尺寸一致。球在浅角纠正的缓冲阶段会保持纯白外观，但叠加轻微抖动与手绘噪线以强调危险状态。
- **虚化墙**：保持同样轮廓，但透明度降低（约 30%）。
- **障碍**：与墙体厚度相同的纯白小墙，从上/左/右墙向场地内部延伸，带有伸缩动画和轻微回弹。受击后颜色会以快入慢出的方式渐变为偏红色调；累计三次受击后沿与普通收回一致的抽屉动画退场，并伴随淡红渐隐。
- **尖刺指示器**：当新的障碍开始抽出时，在下一堵目标墙体内侧即时弹出小型三角尖刺，带有快速伸缩动画并指向场地内部，用于提示下一次障碍位置。
- **界面**：中央悬浮透明数字显示连击次数，每次底墙反弹时屏幕产生短暂模糊与闪光，并将数字递增；模糊的峰值强度与球速相关，速度越快闪光越明显。
- **界面**：中央悬浮透明数字显示连击次数，每次底墙反弹时屏幕产生短暂模糊与闪光，并将数字递增；模糊的峰值强度与球速相关，速度越快闪光越明显。模糊上限可通过 `scripts/game_manager.gd` 的导出变量 `combo_blur_max_intensity` 调整（默认 `0.35`）。
- **UI**：保持极简，默认不显示多余元素，仅在重置时短暂闪烁提示（后续迭代）。
- **音效**：使用合成正弦波短音，依据底部反弹次数逐次提高半音，形成不断爬升的音阶。

## 可玩原型范围

- 单一关卡，屏幕尺寸固定。
- 球速、加速倍率、音阶起始值可在 Inspector 调整。
- 最多生成 3 个障碍物，刷新于每次重置。
- 未实现分数/排行榜，仅记录连击次数（显示在调试输出）。

## 后续扩展想法

- 根据连击次数改变背景音景与视觉特效。
- 加入多种障碍形状与动态移动障碍。
- 增设失败反馈与复位动画。
- 引入渐进式关卡或节奏谱面。
